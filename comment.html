<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="alan_tsaiçš„å°å±‹">
    <meta property="og:description" content="æˆ‘æ˜¯å¼±å¼±çš„å¯«ç¨‹å¼æ–°æ‰‹ï¼Œæ­¡è¿ä¾†é€™è£¡ç•™ä¸‹ä½ çš„ç•™è¨€ï¼">
    <meta property="og:image" content="https://i.imgur.com/reW9Wxp.png">
    <meta property="og:url" content="https://vercel.com/dds-projects-0a3234a7/dddayo0214-github-io">
    <meta property="og:type" content="website">
    <link rel="shortcut icon" href="merterial/apex-logo.ico" type="image/x-icon">
    <title>Tsai alançš„å°å±‹</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <script src="https://unpkg.com/counterup2@2.0.2/dist/index.js">	</script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <link rel="stylesheet" href="mywebside_css.css">
    <link rel="stylesheet" href="comment.css">
    <script src="comment.js" defer></script>

</head>

<body>
    <div class="custom-cursor" id="bodytop">
        <img class="rotationAnime" src="merterial/rocket.png" alt="custom cursor" id="bodytop_">
    </div>
    <div class="custom-cursorFollower">
        <img class="rotationAnime" src="merterial/comet.png" alt="custom cursorFollower">
    </div>
    <div class="scroll-progress"></div>

    <canvas id="canvas"></canvas>

    <div>
        <div class="image-overlay" id="å­¸ç§‘èƒ½åŠ›ç«¶è³½">
            <span class="close-btn">&times;</span>
            <img id="fullImage" src="merterial/å¸‚è³½è³‡è¨Šä½³ä½œ.jpg" alt="å®Œæ•´å¤§åœ–">
        </div>
        <div class="image-overlay" id="å¤šç›Š">
            <span class="close-btn">&times;</span>
            <img id="fullImage" src="merterial/toeic715.jpg" alt="å®Œæ•´å¤§åœ–">
        </div>
        <div class="image-overlay" id="nckué‚€è«‹è³½">
            <span class="close-btn">&times;</span>
            <img id="fullImage" src="merterial/nckué‚€è«‹è³½.jpg" alt="å®Œæ•´å¤§åœ–">
        </div>
        <div class="image-overlay" id="è‹±æª¢ä¸­ç´š">
            <span class="close-btn">&times;</span>
            <img id="fullImage" src="merterial/è‹±æª¢ä¸­ç´š.jpg" alt="å®Œæ•´å¤§åœ–">
        </div>
        <div class="image-overlay" id="å‹•ç‰©è‚²æœ›">
            <span class="close-btn">&times;</span>
            <img id="fullImage" src="merterial/å‹•ç‰©è‚²æœ›.jpg" alt="å®Œæ•´å¤§åœ–">
        </div>
        <div class="image-overlay" id="çç‰Œ">
            <span class="close-btn">&times;</span>
            <img id="fullImage" src="merterial/çç‰Œ.jpg" alt="å®Œæ•´å¤§åœ–">
        </div>
    </div>

    <audio id="bg-music" autoplay loop>
        <source src="merterial/gawr_gura_bgm.mp3" type="audio/mpeg">
        æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´éŸ³è¨Šå…ƒç´ ã€‚
    </audio>

    <nav>
        <div class="nav-content" id="nav-content">
            <div class="nav-wight">
                <div class="nav-logo">
                    <!-- <img src="merterial/hinano.png" alt="logo"> -->
                </div>
                <div class="logo">Tsai alançš„æ­¡æ¨‚å°å±‹</div>
            </div>
            <div class="nav-links">
                <a href="index.html">é¦–é </a>
                <a href="project.html">ä½œå“</a>
                <a href="comment.html" class="active">ç•™è¨€</a>
                <a href="code.html">éƒ¨è½æ ¼</a>
                <div class="nav-indicator"></div>
            </div>
        </div>
    </nav>

    <section class="comment" id="comment">
        <div class="comment-container">
            <div id="auth-container">
                <button class="btn" id="login-btn">ä½¿ç”¨ Google ç™»å…¥ç•™è¨€!</button>
                <button class="btn" id="logout-btn" style="display: none;">ç™»å‡º</button>
            </div>
            <div id="user-info" style="display: none;">
                <p>æ­¡è¿ï¼Œ<span id="user-name"></span>ï¼</p>
            </div>
            <div class="input-container" id="input-area">
                <input type="text" id="tech-input" placeholder="è«‹è¼¸å…¥è³‡æ–™" onfocus="this.placeholder=''"
                    onblur="this.placeholder='è«‹è¼¸å…¥è³‡æ–™'">
                <label for="tech-input"></label>
            </div>
            <div id="note-container"></div>
        </div>
    </section>

    <div class="footer">Copyright &copy Tsai alan</div>

</body>

<script>
    // åˆå§‹åŒ– Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyAPuD2i6aqk77vh7A6C3Nctri2m-YQrdjA",
        authDomain: "my-webside-97ee7.firebaseapp.com",
        databaseURL: "https://my-webside-97ee7-default-rtdb.firebaseio.com",
        projectId: "my-webside-97ee7",
        storageBucket: "my-webside-97ee7.appspot.com",
        messagingSenderId: "131325164583",
        appId: "1:131325164583:web:8c1cc0c4636d72e3916202",
        measurementId: "G-HCZ5T7EK4F"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const database = firebase.database();

    // ç•™è¨€æ¿åŠŸèƒ½
    const loginBtn = document.getElementById("login-btn");
    const logoutBtn = document.getElementById("logout-btn");
    const inputArea = document.getElementById("input-area");
    const noteContainer = document.getElementById("note-container");
    const noteInput = document.getElementById("tech-input");
    let userTimes;

    auth.onAuthStateChanged(user => { updateUI(user); });

    loginBtn.addEventListener("click", () => {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider);
    });

    function createNote(text, timestamp, noteId, userId, displayName) {
        if (!text.trim()) return;

        const user = auth.currentUser;
        const note = document.createElement("div");
        note.dataset.id = noteId;
        note.classList.add("note");
        note.dataset.timestamp = timestamp;

        // é¡¯ç¤ºä½¿ç”¨è€…åç¨±
        const userLabel = document.createElement("div");
        userLabel.classList.add("user-label");
        userLabel.innerText = `âœï¸ ${displayName}`; // é¡¯ç¤ºç™¼é€è€…åç¨±
        userLabel.style.fontSize = "12px";
        userLabel.style.fontWeight = "bold";
        userLabel.style.color = "#333";
        userLabel.style.marginBottom = "5px";

        // å…§å®¹
        const content = document.createElement("div");
        content.classList.add("content");
        content.innerText = text;

        // æ™‚é–“æˆ³è¨˜
        const timeLabel = document.createElement("div");
        timeLabel.classList.add("timestamp");
        timeLabel.innerText = timestamp;

        note.appendChild(userLabel); // åŠ å…¥ä½¿ç”¨è€…åç¨±
        note.appendChild(content);
        note.appendChild(timeLabel);

        // âœ… åªæœ‰ç•™è¨€ä½œè€…æ‰èƒ½åˆªé™¤
        const deleteBtn = document.createElement("button");
        deleteBtn.innerText = "åˆªé™¤";
        deleteBtn.style.backgroundColor = "rgba(183, 5, 5, 0.638)";
        deleteBtn.style.color = "white";
        deleteBtn.style.border = "none";
        deleteBtn.style.padding = "5px";
        deleteBtn.style.cursor = "pointer";
        deleteBtn.style.marginTop = "40px";
        deleteBtn.addEventListener("click", () => {
            if (user && user.uid === userId) {
                if (confirm("ç¢ºå®šè¦åˆªé™¤é€™å‰‡ç•™è¨€å—ï¼Ÿ")) {
                    db.collection("notes").doc(noteId).delete().then(() => {
                        console.log("ç•™è¨€å·²åˆªé™¤");
                    }).catch((error) => {
                        console.error("åˆªé™¤å¤±æ•—:", error);
                    });
                }
            }
            else {
                alert("åªæœ‰ç•™è¨€ä½œè€…æ‰èƒ½åˆªé™¤ç•™è¨€ï¼");
            }

        }); note.appendChild(deleteBtn);
        noteContainer.appendChild(note);
    }

    noteInput.addEventListener("keydown", function (e) {
        const timestamp = new Date().toISOString();  // æ”¹ç”¨ ISO æ ¼å¼
        if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            const user = auth.currentUser;
            if (user) {
                let text = noteInput.value.trim();
                // ğŸ”¥ é™åˆ¶ä¾¿æ¢ç´™æ•¸é‡ï¼ˆä¾‹å¦‚ï¼šæœ€å¤š 5 å¼µï¼‰
                const userNotes = db.collection("notes")
                    .where("userId", "==", user.uid)
                    .get()
                    .then((userNotes) => {
                        if (userNotes.size >= 5) {
                            alert("ä½ å·²ç¶“é”åˆ° 5 å‰‡ä¾¿æ¢ç´™çš„ä¸Šé™ï¼Œè«‹å…ˆåˆªé™¤èˆŠçš„å†æ–°å¢ï¼");
                            return;
                        }
                        db.collection("notes").add({
                            text: noteInput.value,
                            timestamp,
                            userId: user.uid,  // âœ… è¨˜éŒ„ä½¿ç”¨è€…çš„ UID
                            displayName: user.displayName || "åŒ¿åç”¨æˆ¶"  // âœ… è¨˜éŒ„ç”¨æˆ¶åç¨±ï¼Œè‹¥ç„¡å‰‡é¡¯ç¤ºã€ŒåŒ¿åç”¨æˆ¶ã€
                        });
                        noteInput.value = "";
                    })
                    .catch((error) => {
                        console.error("ç²å–ä¾¿æ¢ç´™æ•¸é‡æ™‚å‡ºéŒ¯:", error);
                    });

                // é™åˆ¶å­—æ•¸
                if (text.length > 200) {
                    alert("ç•™è¨€æœ€å¤š 200 å­—ï¼");
                    return;
                }

                // éæ¿¾çˆ†è¨€
                const bannedWords = ["é«’è©±1", "é«’è©±2", "ç¦è©"];
                for (let word of bannedWords) {
                    if (text.includes(word)) {
                        alert("ç•™è¨€åŒ…å«ç¦ç”¨è©å½™ï¼");
                        return;
                    }
                }
            }
        }
    });

    db.collection("notes").orderBy("timestamp").onSnapshot(snapshot => {
        snapshot.docChanges().forEach(change => {
            if (change.type === "added") {
                const doc = change.doc;
                createNote(
                    doc.data().text,
                    doc.data().timestamp,
                    doc.id,
                    doc.data().userId,
                    doc.data().displayName || "åŒ¿åç”¨æˆ¶"
                );
            } else if (change.type === "removed") {
                const note = document.querySelector(`[data-id="${change.doc.id}"]`);
                if (note) {
                    note.remove();
                }
            }
        });
    });

    logoutBtn.addEventListener("click", () => {
        auth.signOut().then(() => {
            alert("å·²æˆåŠŸç™»å‡ºï¼");
            updateUI(null); // ç¢ºä¿ UI ä¹ŸåŒæ­¥æ›´æ–°
        }).catch((error) => {
            console.error("ç™»å‡ºå¤±æ•—:", error);
            alert("ç™»å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ï¼");
        });
    });

    function updateUI(user) {
        const userInfo = document.getElementById("user-info");
        const userNameSpan = document.getElementById("user-name");

        if (user) {
            loginBtn.style.display = "none";
            logoutBtn.style.display = "block";
            inputArea.style.display = "block";

            // é¡¯ç¤ºä½¿ç”¨è€…åç¨±
            userInfo.style.display = "block";
            userNameSpan.textContent = user.displayName || "è¨ªå®¢"; // å¦‚æœæ²’æœ‰åç¨±ï¼Œé¡¯ç¤ºã€Œè¨ªå®¢ã€
        } else {
            loginBtn.style.display = "block";
            logoutBtn.style.display = "none";
            inputArea.style.display = "none";

            // éš±è—ä½¿ç”¨è€…è³‡è¨Š
            userInfo.style.display = "none";
        }
    }

    // ç•¶ç™»å…¥ç‹€æ…‹æ”¹è®Šæ™‚æ›´æ–° UI
    auth.onAuthStateChanged(user => {
        updateUI(user);
    });

</script>

</html>