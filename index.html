<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="merterial/apex-logo.ico" type="image/x-icon">
    <title>Tsai alan的小屋</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <script src="https://www.googletagmanager.com/gtag/js?id=G-YB0RS7N314" async></script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2278940316427292"
        crossorigin="anonymous"></script>

    <script src="https://unpkg.com/counterup2@2.0.2/dist/index.js">	</script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <link rel="stylesheet" href="mywebside_css.css">
    <script src="mywebside_js.js" defer></script>

</head>

<body>
    <div class="custom-cursor" id="bodytop">
        <img class="rotationAnime" src="merterial/rocket.png" alt="custom cursor" id="bodytop_">
    </div>
    <div class="custom-cursorFollower">
        <img class="rotationAnime" src="merterial/comet.png" alt="custom cursorFollower">
    </div>
    <div class="scroll-progress"></div>

    <canvas id="canvas"></canvas>

    <div>
        <div class="image-overlay" id="學科能力競賽">
            <span class="close-btn">&times;</span>
            <img id="fullImage" src="merterial/市賽資訊佳作.jpg" alt="完整大圖">
        </div>
        <div class="image-overlay" id="多益">
            <span class="close-btn">&times;</span>
            <img id="fullImage" src="merterial/toeic715.jpg" alt="完整大圖">
        </div>
        <div class="image-overlay" id="ncku邀請賽">
            <span class="close-btn">&times;</span>
            <img id="fullImage" src="merterial/ncku邀請賽.jpg" alt="完整大圖">
        </div>
        <div class="image-overlay" id="英檢中級">
            <span class="close-btn">&times;</span>
            <img id="fullImage" src="merterial/英檢中級.jpg" alt="完整大圖">
        </div>
        <div class="image-overlay" id="動物育望">
            <span class="close-btn">&times;</span>
            <img id="fullImage" src="merterial/動物育望.jpg" alt="完整大圖">
        </div>
        <div class="image-overlay" id="獎牌">
            <span class="close-btn">&times;</span>
            <img id="fullImage" src="merterial/獎牌.jpg" alt="完整大圖">
        </div>
    </div>

    <audio id="bg-music" autoplay loop>
        <source src="merterial/gawr_gura_bgm.mp3" type="audio/mpeg">
        您的瀏覽器不支援音訊元素。
    </audio>

    <input type="checkbox" name="" id="sideMenu-active">

    <div class="sideMenu">
        <div class="nav-aside">
            <a href="#home" class="active btn">首頁</a>
            <a href="#about" class="btn">關於</a>
            <a href="#timeline" class="btn">歷程</a>
            <a href="#projects" class="btn">作品</a>
            <a href="#contact" class="btn">聯絡</a>
            <a href="#comment" class="btn">留言</a>
            <button class="btn" onclick="editAnimation()">改變背景動畫</button>
            <ul>
                <div class="input-group not-visible" id="math-input">
                    <label>σ: <input type="number" id="sigma" value="10" step="0.1"></label>
                    <label>ρ: <input type="number" id="rho" value="28" step="0.1"></label>
                    <label>β: <input type="number" id="beta" value="2.67" step="0.01"></label>
                    <button class="btn" id="math-reset" onclick="resetValues()">ResetValues</button>
                    <button class="btn" id="effect-close" onclick="closeEffect()">StopEffects</button>
                    <button class="btn" id="effect-start" onclick="startEffect()">StartEffects</button>
                </div>
            </ul>
        </div>
        <label class="nav-aside-label" for="sideMenu-active">
            <i class="fas fa-angle-right"></i>
        </label>
    </div>

    <nav>
        <div class="nav-content" id="nav-content">
            <div class="nav-wight">
                <div class="nav-logo">
                    <!-- <img src="merterial/hinano.png" alt="logo"> -->
                </div>
                <div class="logo">Tsai alan的歡樂小屋</div>
            </div>
            <div class="nav-links">
                <a href="#home" class="active">首頁</a>
                <a href="#about">關於</a>
                <a href="#timeline">歷程</a>
                <a href="#projects">作品</a>
                <a href="#contact">聯絡</a>
                <a href="#comment">留言</a>
                <div class="nav-indicator"></div>
            </div>
        </div>
    </nav>

    <section class="hero" id="home">
        <div class="hero-content">
            <h1>歡迎來到Tsai alan的網站</h1>
            <p>程式設計師 / 運動員</p>
            <div class="social-links">
                <a href="https://github.com/DDDAYO0214"><i class="fab fa-github"></i></a>
                <a href="https://www.facebook.com/profile.php?id=100006945799099"><i class="fab fa-facebook"></i></a>
                <a href="https://www.instagram.com/alan_c8c8?igsh=MTM2bWU4czlxNTYzdw=="><i
                        class="fab fa-instagram"></i></a>
            </div>
            <div class="tools-container">
                <h1>我的開發工具集</h1>

                <div class="tool-card" onclick="toggleDescription('vscode')">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fas fa-code"></i>
                        </div>
                        <h2 class="tool-title">Visual Studio Code</h2>
                    </div>
                    <div class="tool-description" id="vscode-description">
                        <p>Visual Studio Code是我主要使用的程式碼編輯器</p>
                        <ul>
                            <li>強大的智能代碼補全</li>
                            <li>豐富的擴充套件生態系統</li>
                            <li>整合式終端機</li>
                            <li>Git版本控制整合</li>
                        </ul>
                    </div>
                </div>

                <div class="tool-card" onclick="toggleDescription('google')">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <i class="fab fa-google"></i>
                        </div>
                        <h2 class="tool-title">Google</h2>
                    </div>
                    <div class="tool-description" id="google-description">
                        <p>Google提供多項實用的開發工具</p>
                        <ul>
                            <li>強大的搜尋引擎，快速找到解決方案</li>
                            <li>Chrome DevTools用於網頁除錯</li>
                            <li>Google Fonts免費字型資源</li>
                            <li>Google搜尋控制台協助優化網站</li>
                        </ul>
                    </div>
                </div>

                <div class="tool-card" onclick="toggleDescription('apex')">
                    <div class="tool-header">
                        <div class="tool-icon">
                            <div class="apex-icon"></div>
                        </div>
                        <h2 class="tool-title">apex</h2>
                    </div>
                    <div class="tool-description" id="apex-description">
                        <p>Apex是打發時間的好工具</p>
                        <ul>
                            <li>不須拘泥於輸贏</li>
                            <li>隊友活潑好動</li>
                            <li>牌位當普通場打</li>
                            <li>商店商品滿滿</li>
                        </ul>
                    </div>
                </div>

            </div>
    </section>

    <section class="about" id="about">
        <div class="about-content">
            <div class="about-image">
                <img src="merterial/hinano.png" alt="個人照片">
            </div>
            <div class="about-text">
                <h2>關於我</h2>
                <p>我是蔡昇倫，目前就讀於中和高中，對科技充滿好奇。</p>
                <p>我主動學習新的程式語言與技術，希望能夠提升自己的能力。</p>
                <p> 此外，我也熱愛運動，桌球是我最喜歡的運動之一。</p>
                <p>這項運動不僅讓我鍛鍊體能，也培養了我的耐心與毅力。</p>
                <p>未來，我希望能夠將我的專長發揮在更廣泛的領域，我會持續努力學習，精進自己的能力，朝著成為一名優秀工程師的目標邁進。</p>
                <br>
                <div class="skills">
                    <h3>背景</h3>
                    <div class="profiles">
                        <span class="profile">生日: 2/14 </span>
                        <span class="profile">星座: 水瓶</span>
                        <span class="profile">生肖: 我也不知道</span>
                        <span class="profile">興趣: 寫程式 玩遊戲</span>
                        <span class="profile">專長: 打桌球</span>
                    </div>
                    <br>
                    <h3>學習技能</h3>
                    <div class="skill-tags">
                        <span class="skill-tag">HTML</span>
                        <span class="skill-tag">CSS</span>
                        <span class="skill-tag">python</span>
                        <span class="skill-tag">C++</span>
                        <span class="skill-tag">C#</span>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </section>

    <section class="timeline" id="timeline">
        <h2>人生歷程</h2>
        <div class="timeline-container">
            <div class="timeline-item">
                <div class="timeline-content">
                    <div class="timeline-date">
                        <i class="fas fa-calendar-alt"></i> now
                    </div>
                    <div class="timeline-title">現在</div>
                    <p>正在體驗中。</p>
                </div>
            </div>

            <div class="timeline-item">
                <div class="timeline-content">
                    <div class="timeline-date">
                        <i class="fas fa-calendar-alt"></i> 2022 - now
                    </div>
                    <div class="timeline-title">高中生涯</div>
                    <p>開始學習程式設計。</p>
                    <div class="timeline-achievements">成果
                        <div class="image-container">
                            <div class="image-link" onclick="toggleAchievements('學科能力競賽')">
                                學科能力競賽
                            </div>
                            <div class="image-link" onclick="toggleAchievements('多益')">
                                多益
                            </div>
                            <div class="image-link" onclick="toggleAchievements('ncku邀請賽')">
                                ncku邀請賽 第42/200名
                            </div>
                            <div class="image-link" onclick="toggleAchievements('英檢中級')">
                                英檢中級
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="timeline-item">
                <div class="timeline-content">
                    <div class="timeline-date">
                        <i class="fas fa-calendar-alt"></i> 2019 - 2022
                    </div>
                    <div class="timeline-title">國中生涯</div>
                    <p>美術班中的普通生。</p>
                    <div class="timeline-achievements">成果
                        <div class="image-container">
                            <div class="image-link" onclick="toggleAchievements('動物育望')">
                                動物育望佳作
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="timeline-item">
                <div class="timeline-content">
                    <div class="timeline-date">
                        <i class="fas fa-calendar-alt"></i> 2013-2019
                    </div>
                    <div class="timeline-title">國小生涯</div>
                    <p>天真無邪愛玩的桌球隊隊員。</p>
                    <div class="timeline-achievements">成果
                        <div class="image-container">
                            <div class="image-link" onclick="toggleAchievements('獎牌')">
                                各種獎牌
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="timeline-item">
                <div class="timeline-content">
                    <div class="timeline-date">
                        <i class="fas fa-calendar-alt"></i> 出生-2013
                    </div>
                    <div class="timeline-title">歡樂時期</div>
                    <p>hehe :D。</p>
                </div>
            </div>
        </div>
    </section>

    <section class="projects" id="projects">
        <h2>作品集</h2>
        <div class="project-grid">
            <div class="project-card">
                <img src="merterial/敬請期待.png" alt="專案一">
                <div class="project-info">
                    <h3>專案一</h3>
                    <p>這是一個很棒的專案描述</p>
                </div>
            </div>
            <div class="project-card">
                <img src="merterial/敬請期待.png" alt="專案二">
                <div class="project-info">
                    <h3>專案二</h3>
                    <p>另一個精彩的專案描述</p>
                </div>
            </div>
            <div class="project-card">
                <img src="merterial/敬請期待.png" alt="專案三">
                <div class="project-info">
                    <h3>專案三</h3>
                    <p>第三個令人驚嘆的專案</p>
                </div>
            </div>
        </div>
    </section>

    <section class="contact" id="contact">
        <h2>聯絡我</h2>
        <p>歡迎與我聯繫!</p>
        <div class="contact-links">
            <a href="mailto:alan0960214@email.com@email.com" class="contact-link">
                <i class="fas fa-envelope"></i>
                <span>alan0960214@email.com</span>
            </a>
            <a href="https://github.com/DDDAYO0214" class="contact-link">
                <i class="fab fa-github"></i>
                <span>GitHub</span>
            </a>
            <a href="https://www.facebook.com/profile.php?id=100006945799099" class="contact-link">
                <i class="fab fa-facebook"></i>
                <span>FB</span>
            </a>
            <a href="https://www.instagram.com/alan_c8c8?igsh=MTM2bWU4czlxNTYzdw" class="contact-link">
                <i class="fab fa-instagram"></i>
                <span>IG</span>
            </a>
        </div>
    </section>

    <section class="visitnumber">
        <h1>歡迎光臨！</h1>
        <p>本站目前瀏覽次數：<span class="counter" id="visitor-count">載入中...</span></p>
        <p>您目前瀏覽次數：<span class="userCounter" id="userVisitor-count">載入中...</span></p>
    </section>

    <section class="comment" id="comment">
        <div class="comment-container">
            <div id="auth-container">
                <button class="btn" id="login-btn">使用 Google 登入留言!</button>
                <button class="btn" id="logout-btn" style="display: none;">登出</button>
            </div>
            <div id="user-info" style="display: none;">
                <p>歡迎，<span id="user-name"></span>！</p>
            </div>
            <div id="input-area">
                <textarea id="note-input" placeholder="輸入留言後按 Enter"></textarea>
            </div>
            <div id="note-container"></div>
        </div>
        <div class="floor"></div>
        <div class="gift-container">
            <div>
                <div class="set-hint visible" id="setHint">點擊禮物獲得驚喜</div>
                <div class="reset-hint" id="resetHint">拖動蓋子回到禮物盒頂端以重置</div>
                <div class="box-lid" id="boxLid">
                    <div class="ribbon" id="ribbon"></div>
                </div>
                <div class="box-base" id="boxBase"></div>

                <div class="gift-text" id="giftText">生日快樂！</div>
            </div>
        </div>
    </section>

    <div class="footer">Copyright &copy Tsai alan</div>

</body>

<script>
    // 初始化 Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyAPuD2i6aqk77vh7A6C3Nctri2m-YQrdjA",
        authDomain: "my-webside-97ee7.firebaseapp.com",
        databaseURL: "https://my-webside-97ee7-default-rtdb.firebaseio.com",
        projectId: "my-webside-97ee7",
        storageBucket: "my-webside-97ee7.appspot.com",
        messagingSenderId: "131325164583",
        appId: "1:131325164583:web:8c1cc0c4636d72e3916202",
        measurementId: "G-HCZ5T7EK4F"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const database = firebase.database();

    // 瀏覽次數計數
    const counterRef = database.ref("page_views");
    counterRef.transaction((current) => {
        return (current || 0) + 1;
    }).then(({ snapshot }) => {
        document.querySelector('.counter').innerText = snapshot.val();
    }).catch((error) => {
        console.error("更新計數失敗:", error);
    });

    // 使用 LocalStorage 計算瀏覽次數
    let count = localStorage.getItem('page_views') || 0;
    count++;
    localStorage.setItem('page_views', count);
    document.getElementById('userVisitor-count').innerText = count;

    // 留言板功能
    const loginBtn = document.getElementById("login-btn");
    const logoutBtn = document.getElementById("logout-btn");
    const inputArea = document.getElementById("input-area");
    const noteContainer = document.getElementById("note-container");
    const noteInput = document.getElementById("note-input");

    auth.onAuthStateChanged(user => { updateUI(user); });

    loginBtn.addEventListener("click", () => {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider);
    });

    function createNote(text, timestamp, noteId, userId, displayName) {
        if (!text.trim()) return;

        const user = auth.currentUser;
        const note = document.createElement("div");
        note.dataset.id = noteId;
        note.classList.add("note");
        note.dataset.timestamp = timestamp;

        // 顯示使用者名稱
        const userLabel = document.createElement("div");
        userLabel.classList.add("user-label");
        userLabel.innerText = `✏️ ${displayName}`; // 顯示發送者名稱
        userLabel.style.fontSize = "12px";
        userLabel.style.fontWeight = "bold";
        userLabel.style.color = "#333";
        userLabel.style.marginBottom = "5px";

        // 內容
        const content = document.createElement("div");
        content.classList.add("content");
        content.innerText = text;

        // 時間戳記
        const timeLabel = document.createElement("div");
        timeLabel.classList.add("timestamp");
        timeLabel.innerText = timestamp;

        note.appendChild(userLabel); // 加入使用者名稱
        note.appendChild(content);
        note.appendChild(timeLabel);

        // ✅ 只有留言作者才能刪除
        if (user && user.uid === userId) {
            const deleteBtn = document.createElement("button");
            deleteBtn.innerText = "刪除";
            deleteBtn.style.backgroundColor = "red";
            deleteBtn.style.color = "white";
            deleteBtn.style.border = "none";
            deleteBtn.style.padding = "5px";
            deleteBtn.style.cursor = "pointer";

            deleteBtn.addEventListener("click", () => {
                if (confirm("確定要刪除這則留言嗎？")) {
                    db.collection("notes").doc(noteId).delete().then(() => {
                        console.log("留言已刪除");
                    }).catch((error) => {
                        console.error("刪除失敗:", error);
                    });
                }
            });
            note.appendChild(deleteBtn);
        }
        noteContainer.appendChild(note);
    }

    noteInput.addEventListener("keydown", function (e) {
        const timestamp = new Date().toISOString();  // 改用 ISO 格式
        if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            const user = auth.currentUser;
            if (user) {
                let text = noteInput.value.trim();
                db.collection("notes").add({
                    text: noteInput.value,
                    timestamp,
                    userId: user.uid,  // ✅ 記錄使用者的 UID
                    displayName: user.displayName || "匿名用戶"  // ✅ 記錄用戶名稱，若無則顯示「匿名用戶」
                });
                noteInput.value = "";

                // 限制字數
                if (text.length > 200) {
                    alert("留言最多 200 字！");
                    return;
                }

                // 過濾爆言
                const bannedWords = ["髒話1", "髒話2", "禁詞"];  // 替換成你要過濾的詞
                for (let word of bannedWords) {
                    if (text.includes(word)) {
                        alert("留言包含禁用詞彙！");
                        return;
                    }
                }

                db.collection("notes").add({ text, timestamp });
                noteInput.value = "";
            }
        }
    });

    db.collection("notes").orderBy("timestamp").onSnapshot(snapshot => {
        const existingNotes = new Set();
        snapshot.forEach(doc => {
            existingNotes.add(doc.id);
            if (!document.querySelector(`[data-id="${doc.id}"]`)) {
                createNote(
                    doc.data().text,
                    doc.data().timestamp,
                    doc.id,
                    doc.data().userId,
                    doc.data().displayName
                );
            }
        });

        // 移除 Firestore 已刪除的便條紙
        document.querySelectorAll(".note").forEach(note => {
            if (!existingNotes.has(note.dataset.id)) {
                note.remove();
            }
        });
    });

    logoutBtn.addEventListener("click", () => {
        auth.signOut().then(() => {
            alert("已成功登出！");
            updateUI(null); // 確保 UI 也同步更新
        }).catch((error) => {
            console.error("登出失敗:", error);
            alert("登出失敗，請稍後再試！");
        });
    });

    function updateUI(user) {
        const userInfo = document.getElementById("user-info");
        const userNameSpan = document.getElementById("user-name");

        if (user) {
            loginBtn.style.display = "none";
            logoutBtn.style.display = "block";
            inputArea.style.display = "block";

            // 顯示使用者名稱
            userInfo.style.display = "block";
            userNameSpan.textContent = user.displayName || "訪客"; // 如果沒有名稱，顯示「訪客」
        } else {
            loginBtn.style.display = "block";
            logoutBtn.style.display = "none";
            inputArea.style.display = "none";

            // 隱藏使用者資訊
            userInfo.style.display = "none";
        }
    }

    // 當登入狀態改變時更新 UI
    auth.onAuthStateChanged(user => {
        updateUI(user);
    });

</script>

</html>